<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safar Saathi — Kerala Travel Diary (Prototype)</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Auth Overlay */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .overlay.hidden {
      display: none;
    }
    
    .auth-card {
      display: flex;
      max-width: 900px;
      width: 100%;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    .auth-left {
      flex: 1;
      position: relative;
      display: none;
    }
    
    .auth-left img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .overlay-text {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
      color: white;
      padding: 20px;
    }
    
    .auth-right {
      flex: 1;
      padding: 30px;
    }
    
    .auth-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .tab {
      padding: 10px 15px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: #777;
      position: relative;
    }
    
    .tab.active {
      color: #4a6cf7;
      font-weight: 600;
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 3px;
      background: #4a6cf7;
      border-radius: 3px 3px 0 0;
    }
    
    .form-block {
      display: none;
    }
    
    .form-block:not(.hidden) {
      display: block;
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #4a6cf7;
      box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .btn.primary {
      background: #4a6cf7;
      color: white;
      width: 100%;
    }
    
    .btn.primary:hover {
      background: #3a5cd8;
    }
    
    .btn.secondary {
      background: #6c757d;
      color: white;
      width: 100%;
    }
    
    .btn.secondary:hover {
      background: #5a6268;
    }
    
    .btn.outline {
      background: transparent;
      border: 1px solid #4a6cf7;
      color: #4a6cf7;
    }
    
    .btn.outline:hover {
      background: #4a6cf7;
      color: white;
    }
    
    .btn.ghost {
      background: transparent;
      color: #4a6cf7;
    }
    
    .btn.ghost:hover {
      background: rgba(74, 108, 247, 0.1);
    }
    
    .btn.google {
      background: #db4437;
      color: white;
      width: 100%;
      margin-top: 10px;
    }
    
    .btn.google:hover {
      background: #c33c2e;
    }
    
    .small {
      font-size: 12px;
    }
    
    .muted {
      color: #6c757d;
    }
    
    .auth-footer {
      margin-top: 20px;
      font-size: 12px;
      text-align: center;
    }
    
    /* Consent Overlay */
    .consent-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    .consent-card h2 {
      margin-bottom: 15px;
      color: #2c3e50;
    }
    
    .consent-card p {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .checkbox {
      display: flex;
      align-items: flex-start;
      margin-bottom: 20px;
    }
    
    .checkbox input {
      margin-right: 10px;
      margin-top: 5px;
      width: auto;
    }
    
    .consent-actions {
      display: flex;
      gap: 10px;
    }
    
    /* Main App */
    .app {
      display: none;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .app:not(.hidden) {
      display: flex;
    }
    
    .topbar {
      background: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo {
      font-size: 28px;
    }
    
    .title {
      font-weight: 700;
      font-size: 18px;
      color: #2c3e50;
    }
    
    .subtitle {
      font-size: 12px;
      color: #6c757d;
    }
    
    .top-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .points {
      padding: 8px 15px;
      background: #f8f9fa;
      border-radius: 20px;
      font-size: 14px;
    }
    
    .user-info {
      padding: 8px 15px;
      background: #e8f4fd;
      border-radius: 20px;
      color: #0a66c2;
      font-size: 14px;
    }
    
    .layout {
      display: flex;
      flex: 1;
    }
    
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 20px 0;
    }
    
    .nav {
      display: block;
      padding: 12px 20px;
      color: #bdc3c7;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .nav:hover, .nav.active {
      background: #34495e;
      color: white;
    }
    
    .nav.danger {
      color: #e74c3c;
    }
    
    .nav.danger:hover {
      background: #e74c3c;
      color: white;
    }
    
    .content {
      flex: 1;
      padding: 30px;
      background: #f8f9fa;
      overflow-y: auto;
    }
    
    .page {
      display: none;
    }
    
    .page.visible {
      display: block;
    }
    
    .hero-card {
      display: flex;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }
    
    .hero-left {
      flex: 1;
      padding: 30px;
    }
    
    .hero-right {
      flex: 1;
      display: none;
    }
    
    .hero-right img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .quick-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .cards-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .row {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .modal.hidden {
      display: none;
    }
    
    .modal-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    .modal-card.wide {
      max-width: 700px;
    }
    
    .close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #6c757d;
    }
    
    #mapid {
      height: 400px;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .map-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .places-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    
    .footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 14px;
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      max-width: 300px;
    }
    
    .toast.hidden {
      display: none;
    }
    
    /* Responsive Design */
    @media (min-width: 768px) {
      .auth-left {
        display: block;
      }
      
      .hero-right {
        display: block;
      }
      
      .cards-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .form-grid {
        grid-template-columns: 2fr 1fr;
      }
      
      .places-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 992px) {
      .places-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Auth overlay -->
  <div id="auth-overlay" class="overlay visible">
    <div class="auth-card">
      <div class="auth-left">
        <img src="https://upload.wikimedia.org/wikipedia/commons/7/71/Kerala_Backwaters.jpg" alt="Kerala" />
        <div class="overlay-text">
          <h2>Safar Saathi</h2>
          <p>Kerala Govt. mobility data pilot — privacy-first, secure, citizen-friendly.</p>
        </div>
      </div>

      <div class="auth-right">
        <div class="auth-tabs">
          <button id="tab-signin" class="tab active">Sign in</button>
          <button id="tab-signup" class="tab">Sign up</button>
          <button id="tab-guest" class="tab">Guest</button>
        </div>

        <div id="signin-form" class="form-block">
          <input id="signin-email" placeholder="Gmail address (required)" />
          <input id="signin-password" type="password" placeholder="Password" />
          <button class="btn primary" id="btn-signin">Sign in</button>
          <div class="small">
            <button id="google-signin" class="btn google">Sign in with Google (placeholder)</button>
          </div>
        </div>

        <div id="signup-form" class="form-block hidden">
          <input id="signup-name" placeholder="Full name" />
          <input id="signup-email" placeholder="Gmail address (required)" />
          <input id="signup-password" type="password" placeholder="Choose a password" />
          <button class="btn primary" id="btn-signup">Create account</button>
          <div class="small muted">We accept Gmail accounts (government incentives use verified Gmail)</div>
        </div>

        <div id="guest-block" class="form-block hidden">
          <h3>Continue as Guest</h3>
          <p class="muted">Guest users can use the app but will <strong>not</strong> earn points or redeem rewards.</p>
          <button class="btn secondary" id="btn-guest">Continue as Guest</button>
        </div>

        <div class="auth-footer muted">By continuing you agree to data collection for government research (location tracking). Consent is requested next.</div>
      </div>
    </div>
  </div>

  <!-- Consent -->
  <div id="consent-overlay" class="overlay hidden">
    <div class="consent-card">
      <h2>Terms & Consent</h2>
      <p>This pilot will collect anonymized location and trip purpose data to improve public transportation planning. Your personal identity is protected and data is stored on secure servers. You may withdraw consent anytime.</p>

      <label class="checkbox">
        <input type="checkbox" id="consent-check" />
        I agree to allow live location for research & accept anonymized storage.
      </label>

      <div class="consent-actions">
        <button class="btn outline" id="consent-back">Back</button>
        <button class="btn primary" id="consent-continue">Continue</button>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="app" class="app hidden">
    <header class="topbar">
      <div class="brand">
        <div class="logo">🚍</div>
        <div>
          <div class="title">Safar Saathi</div>
          <div class="subtitle">Kerala Mobility — NATPAC</div>
        </div>
      </div>

      <div class="top-actions">
        <div class="points">
          <strong id="points-display">0</strong> pts • ₹<span id="balance-display">0.00</span>
        </div>
        <button class="btn ghost" id="open-vault">Vault</button>
        <div class="user-info" id="user-info">Guest</div>
      </div>
    </header>

    <main class="layout">
      <nav class="sidebar">
        <a class="nav active" data-section="home">Home</a>
        <a class="nav" data-section="diary">Travel Diary</a>
        <a class="nav" data-section="map">Live Map</a>
        <a class="nav" data-section="guide">Travel Guide</a>
        <a class="nav" data-section="vault">Vault</a>
        <a class="nav" data-section="about">About</a>
        <a class="nav danger" id="signout">Sign out</a>
      </nav>

      <section class="content">
        <section id="home" class="page visible">
          <div class="hero-card">
            <div class="hero-left">
              <h1>Safar Saathi</h1>
              <p class="muted">AI-assisted travel diary for Kerala — privacy-first and government-backed. Earn points for completed journeys & help shape better transport.</p>
              <div class="quick-actions">
                <button class="btn primary" onclick="navTo('diary')">Log a Journey</button>
                <button class="btn outline" onclick="navTo('map')">Open Live Map</button>
              </div>
            </div>
            <div class="hero-right">
              <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Alleppey_Houseboat.jpg" alt="Alleppey backwaters" />
            </div>
          </div>

          <div class="cards-grid">
            <div class="card">
              <h3>Kerala recommendations</h3>
              <p>Enter a destination in the Travel Diary — the app recommends top places to visit in that city and shows them on the map with distance from you.</p>
              <button class="btn" onclick="navTo('diary')">Try it now</button>
            </div>
            <div class="card">
              <h3>Privacy & security</h3>
              <p>Data is anonymized locally before being shared with government servers. You can opt out any time.</p>
            </div>
            <div class="card">
              <h3>Points & rewards</h3>
              <p>Earn <strong>2 points</strong> (₹0.20) per completed journey. Redeem from the Vault.</p>
            </div>
          </div>
        </section>

        <section id="diary" class="page hidden">
          <h2>Travel Diary Capture</h2>
          <div class="form-grid">
            <div class="card">
              <label>Start location (use current)</label>
              <input id="start-loc" placeholder="Start (or click Use my location)" />
              <div class="row">
                <button class="btn ghost" id="btn-use-location">Use my location</button>
                <button class="btn outline" id="btn-set-manual">Set manual location</button>
              </div>

              <label>Destination (enter city)</label>
              <input id="destination" placeholder="e.g., Kochi, Munnar, Thiruvananthapuram" />
              <div class="row">
                <button class="btn primary" id="btn-show-reco">Show recommendations</button>
                <button class="btn" id="btn-submit-journey">I reached destination</button>
              </div>
            </div>

            <div class="card">
              <h3>Mode & Purpose</h3>
              <select id="mode">
                <option>Bus</option>
                <option>Train</option>
                <option>Car</option>
                <option>Walking</option>
                <option>Bicycle</option>
              </select>
              <input id="purpose" placeholder="Purpose: Work / Education / Shopping / Other" />
              <p class="muted small">After you click "I reached destination" the survey will appear for research purposes.</p>
            </div>
          </div>

          <div id="survey-modal" class="modal hidden">
            <div class="modal-card">
              <h3>Govt. Research Survey</h3>
              <label>How was the journey?</label>
              <select id="survey-rating">
                <option>Good</option>
                <option>Average</option>
                <option>Poor</option>
              </select>
              <label>Issues (optional)</label>
              <input id="survey-issues" placeholder="Traffic, delays, cleanliness..." />
              <div class="row">
                <button class="btn outline" onclick="closeSurvey()">Close</button>
                <button class="btn primary" id="btn-submit-survey">Submit Survey</button>
              </div>
            </div>
          </div>
        </section>

        <section id="map" class="page hidden">
          <h2>Live Map & Recommendations</h2>
          <div class="map-actions">
            <div>
              <button class="btn" id="btn-center-me">Center to my location</button>
              <button class="btn outline" id="btn-clear-markers">Clear markers</button>
            </div>
            <div>
              <label class="small muted">Manual location:</label>
              <input id="manual-lat" placeholder="lat" />
              <input id="manual-lng" placeholder="lng" />
              <button class="btn" id="btn-set-manual-loc">Set</button>
            </div>
          </div>

          <div id="mapid"></div>
          <div id="recommend-list" class="places-list"></div>
        </section>

        <section id="guide" class="page hidden">
          <h2>Kerala Travel Guide — Featured Spots</h2>
          <div class="places-grid" id="guide-grid"></div>
        </section>

        <section id="vault" class="page hidden">
          <h2>Your Vault</h2>
          <div class="card">
            <p>Points: <strong id="vault-points">0</strong></p>
            <p>Balance: ₹<strong id="vault-balance">0.00</strong></p>

            <label>Redeem points</label>
            <input id="redeem-points" placeholder="Enter points to redeem" />
            <div class="row">
              <button class="btn" id="btn-calc-redeem">Calculate</button>
              <button class="btn primary" id="btn-request-redeem">Request Redeem</button>
            </div>

            <div id="redeem-result" class="muted small"></div>
          </div>
        </section>

        <section id="about" class="page hidden">
          <h2>About Safar Saathi</h2>
          <p>Safar Saathi is a government-backed mobility data pilot for Kerala (NATPAC). This prototype demonstrates UI, client-side tracking, recommendations and the points/redeem flow for citizen engagement.</p>
        </section>

      </section>
    </main>

    <footer class="footer">
      © 2025 Safar Saathi • Govt. of Kerala | WarCry (Smart India Hackathon)
    </footer>
  </div>

  <!-- Recommendation modal -->
  <div id="reco-modal" class="modal hidden">
    <div class="modal-card wide">
      <button class="close" onclick="closeReco()">✕</button>
      <h3>Recommended places near your destination</h3>
      <div id="reco-places" class="places-grid"></div>
      <div class="row">
        <button class="btn outline" onclick="closeReco()">Close</button>
        <button class="btn primary" onclick="addRecoToMap()">Show on Map</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script>
    // DOM Elements
    const authOverlay = document.getElementById('auth-overlay');
    const consentOverlay = document.getElementById('consent-overlay');
    const app = document.getElementById('app');
    const authTabs = document.querySelectorAll('.tab');
    const formBlocks = document.querySelectorAll('.form-block');
    const pages = document.querySelectorAll('.page');
    const navLinks = document.querySelectorAll('.nav[data-section]');
    
    // Auth Tab Switching
    authTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Update active tab
        authTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding form
        const formId = `${tab.id.replace('tab-', '')}-form`;
        if (formId === 'guest-form') {
          showForm('guest-block');
        } else {
          showForm(formId);
        }
      });
    });
    
    function showForm(formId) {
      formBlocks.forEach(block => {
        if (block.id === formId) {
          block.classList.remove('hidden');
        } else {
          block.classList.add('hidden');
        }
      });
    }
    
    // Auth Buttons
    document.getElementById('btn-signin').addEventListener('click', handleSignIn);
    document.getElementById('btn-signup').addEventListener('click', handleSignUp);
    document.getElementById('btn-guest').addEventListener('click', handleGuest);
    document.getElementById('consent-back').addEventListener('click', goBackToAuth);
    document.getElementById('consent-continue').addEventListener('click', handleConsent);
    document.getElementById('signout').addEventListener('click', handleSignOut);
    
    function handleSignIn() {
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;
      
      if (!email) {
        showToast('Please enter your email address');
        return;
      }
      
      // Simulate authentication
      showToast('Signing in...');
      setTimeout(() => {
        showConsent();
      }, 1000);
    }
    
    function handleSignUp() {
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      if (!email) {
        showToast('Please enter your email address');
        return;
      }
      
      // Simulate registration
      showToast('Creating account...');
      setTimeout(() => {
        showConsent();
      }, 1000);
    }
    
    function handleGuest() {
      document.getElementById('user-info').textContent = 'Guest User';
      showConsent();
    }
    
    function showConsent() {
      authOverlay.classList.add('hidden');
      consentOverlay.classList.remove('hidden');
    }
    
    function goBackToAuth() {
      consentOverlay.classList.add('hidden');
      authOverlay.classList.remove('hidden');
    }
    
    function handleConsent() {
      if (!document.getElementById('consent-check').checked) {
        showToast('Please agree to the terms to continue');
        return;
      }
      
      consentOverlay.classList.add('hidden');
      app.classList.remove('hidden');
      showToast('Welcome to Safar Saathi!');
    }
    
    function handleSignOut() {
      app.classList.add('hidden');
      authOverlay.classList.remove('hidden');
      showToast('You have been signed out');
    }
    
    // Navigation
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        if (e.target.id === 'signout') return;
        
        const section = e.target.getAttribute('data-section');
        navTo(section);
        
        // Update active nav
        navLinks.forEach(nav => nav.classList.remove('active'));
        e.target.classList.add('active');
      });
    });
    
    function navTo(section) {
      pages.forEach(page => {
        if (page.id === section) {
          page.classList.add('visible');
          page.classList.remove('hidden');
        } else {
          page.classList.add('hidden');
          page.classList.remove('visible');
        }
      });
    }
    
    // Toast notifications
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, duration);
    }
    
    // Initialize map (placeholder)
    function initMap() {
      // This would initialize the Leaflet map
      console.log('Map would be initialized here');
    }
    
    // Initialize the app
    document.addEventListener('DOMContentLoaded', () => {
      // Set up any additional event listeners
      document.getElementById('btn-use-location').addEventListener('click', () => {
        showToast('Fetching your location...');
      });
      
      document.getElementById('btn-show-reco').addEventListener('click', () => {
        const destination = document.getElementById('destination').value;
        if (!destination) {
          showToast('Please enter a destination first');
          return;
        }
        showToast(`Showing recommendations for ${destination}`);
      });
      
      // Initialize map when Map section is opened
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            if (document.getElementById('map').classList.contains('visible')) {
              initMap();
            }
          }
        });
      });
      
      observer.observe(document.getElementById('map'), { attributes: true });
    });
  </script>
</body>
</html>